#:kivy 2.0
#:import RecycleBoxLayout kivy.uix.recycleboxlayout.RecycleBoxLayout
#:import Accordion kivy.uix.accordion.Accordion
#:import AccordionItem kivy.uix.accordion.AccordionItem

<HomeScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1  # Jasnoniebieski gradient
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 15

        Label:
            text: "Monitor Zdrowia"
            font_size: "28sp"
            bold: True
            color: 0.2, 0.4, 0.8, 1  # Niebieski tekst

        Button:
            text: "Waga"
            background_color: 0.4, 0.8, 0.6, 1  # Zielony
            font_size: "22sp"
            on_press: app.root.current = "weight"

        Button:
            text: "Ci≈õnienie"
            background_color: 0.9, 0.5, 0.5, 1  # Koralowy
            font_size: "22sp"
            on_press: app.root.current = "pressure"

        Button:
            text: "Tƒôtno"
            background_color: 0.9, 0.7, 0.8, 1  # R√≥≈ºowy
            font_size: "22sp"
            on_press: app.root.current = "heartrate"

        Button:
            text: "Glukoza"
            background_color: 0.7, 0.8, 0.9, 1  # Jasnoniebieski
            font_size: "22sp"
            on_press: app.root.current = "glucose"

        Button:
            text: "Ustawienia U≈ºytkownika"
            background_color: 0.8, 0.7, 0.9, 1  # Lawendowy
            font_size: "22sp"
            on_press: root.go_to_settings()

        Button:
            text: "Zmie≈Ñ u≈ºytkownika"
            background_color: 0.6, 0.6, 0.6, 1  # Szary
            font_size: "18sp"
            on_press: app.root.current = "login"


<LoginScreen>:
    canvas.before:
        Color:
            rgba: 0.9, 0.95, 1, 1  # Jasnoniebieski
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        Label:
            text: "Logowanie"
            font_size: "28sp"
            bold: True
            color: 0.2, 0.4, 0.8, 1

        Button:
            id: user_selector
            text: "Wybierz u≈ºytkownika"
            background_color: 0.6, 0.7, 0.9, 1
            font_size: "18sp"
            size_hint_y: None
            height: "50sp"
            on_press: root.select_user()

        Label:
            text: "Wprowad≈∫ PIN:"
            font_size: "18sp"
            color: 0.2, 0.4, 0.8, 1
            size_hint_y: None
            height: "30sp"

        TextInput:
            id: pin
            password: True
            multiline: False
            input_filter: "int"
            background_color: 1, 1, 1, 1
            foreground_color: 0, 0, 0, 1
            font_size: "20sp"

        Button:
            text: "Zaloguj"
            background_color: 0.4, 0.8, 0.6, 1  # Zielony
            font_size: "20sp"
            on_press: root.check_pin(pin.text)


<WeightScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 1, 0.95, 1  # Jasnozielony
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Pomiar Wagi"
            font_size: "24sp"
            bold: True
            color: 0.2, 0.6, 0.3, 1

        TextInput:
            id: weight_input
            hint_text: "Waga (kg)"
            input_filter: "float"
            background_color: 1, 1, 1, 1
            font_size: "18sp"

        Button:
            text: "Zapisz"
            background_color: 0.4, 0.8, 0.6, 1
            font_size: "20sp"
            on_press:
                root.save_weight(weight_input.text)
                weight_input.text = ""

        Label:
            text: "Ostatnie 5 pomiar√≥w:"
            size_hint_y: None
            height: "30sp"
            color: 0.3, 0.3, 0.3, 1        

        Button:
            text: "Poka≈º wykres"
            background_color: 0.6, 0.7, 0.9, 1
            font_size: "20sp"
            on_press: root.show_chart()

        Button:
            text: "Historia pomiar√≥w"
            background_color: 0.8, 0.6, 0.9, 1
            font_size: "20sp"
            on_press: app.root.current = "weight_history"

        Button:
            text: "Eksport CSV"
            background_color: 0.9, 0.8, 0.5, 1
            font_size: "20sp"
            on_press: root.export_csv()

        Button:
            text: "Eksport PDF"
            background_color: 0.9, 0.6, 0.5, 1
            font_size: "20sp"
            on_press: root.export_pdf()            



        RecycleView:
            size_hint_y: 0.5
            viewclass: "Label"
            data: root.weights[:5]

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            on_press: app.root.current = "home"




<PressureScreen>:
    canvas.before:
        Color:
            rgba: 1, 0.95, 0.95, 1  # Jasnor√≥≈ºowy
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Ci≈õnienie Tƒôtnicze"
            font_size: "24sp"
            bold: True
            color: 0.8, 0.2, 0.2, 1

        TextInput:
            id: sys
            hint_text: "Skurczowe"
            background_color: 1, 1, 1, 1
            font_size: "18sp"

        TextInput:
            id: dia
            hint_text: "Rozkurczowe"
            background_color: 1, 1, 1, 1
            font_size: "18sp"

        Button:
            text: "Zapisz"
            background_color: 0.9, 0.5, 0.5, 1
            font_size: "20sp"
            on_press:
                root.save_pressure(sys.text, dia.text)
                sys.text = ""
                dia.text = ""

        Label:
            text: "Ostatnie 5 pomiar√≥w:"
            color: 0.3, 0.3, 0.3, 1
            size_hint_y: None
            height: "30sp"

        Button:
            text: "Poka≈º wykres"
            background_color: 0.6, 0.7, 0.9, 1
            font_size: "20sp"
            on_press: root.show_chart()

        Button:
            text: "Historia pomiar√≥w"
            background_color: 0.8, 0.6, 0.9, 1
            font_size: "20sp"
            on_press: app.root.current = "pressure_history"

        Button:
            text: "Eksport CSV"
            background_color: 0.9, 0.8, 0.5, 1
            font_size: "20sp"
            on_press: root.export_csv()

        Button:
            text: "Eksport PDF"
            background_color: 0.9, 0.6, 0.5, 1
            font_size: "20sp"
            on_press: root.export_pdf()



        RecycleView:
            size_hint_y: 0.5
            viewclass: "Label"
            data: root.pressures[:5]

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            on_press: app.root.current = "home"

<SettingsScreen>:
    canvas.before:
        Color:
            rgba: 0.97, 0.95, 1, 1  # Jasnolawendowy
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 5

        Label:
            text: "Ustawienia"
            font_size: "24sp"
            bold: True
            color: 0.5, 0.3, 0.7, 1
            size_hint_y: None
            height: "50sp"

        ScrollView:
            do_scroll_x: False
            
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                size_hint_y: None
                height: self.minimum_height
                padding: [10, 0]

                # === ACCORDION DLA LIMIT√ìW ===
                Accordion:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: dp(500)
                    
                    # === SEKCJA WAGA ===
                    AccordionItem:
                        title: "Limity Wagi (kg)"
                        
                        GridLayout:
                            cols: 2
                            spacing: 5
                            padding: 10
                            
                            Label:
                                text: "Min:"
                                size_hint_x: 0.3
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: w_min
                                hint_text: "Minimalna waga (np. 50)"
                                input_filter: 'float'
                                size_hint_x: 0.7
                            
                            Label:
                                text: "Max:"
                                size_hint_x: 0.3
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: w_max
                                hint_text: "Maksymalna waga (np. 150)"
                                input_filter: 'float'
                                size_hint_x: 0.7

                    # === SEKCJA CI≈öNIENIE ===
                    AccordionItem:
                        title: "Limity Ci≈õnienia (mmHg)"
                        
                        GridLayout:
                            cols: 2
                            spacing: 5
                            padding: 10
                            
                            Label:
                                text: "Skurczowe\nmin:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: sys_min
                                hint_text: "Ci≈õnienie skurczowe minimalne (np. 90)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Rozkurczowe\nmin:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: dia_min
                                hint_text: "Ci≈õnienie rozkurczowe minimalne (np. 60)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Skurczowe\nostrze≈ºenie:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: sys_warn
                                hint_text: "Ci≈õnienie skurczowe zalecane (np. 140)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Rozkurczowe\nostrze≈ºenie:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: dia_warn
                                hint_text: "Ci≈õnienie rozkurczowe zalecane (np. 90)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Skurczowe\nniebezpiecz.:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: sys_danger
                                hint_text: "Ci≈õnienie skurczowe max (np. 180)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Rozkurczowe\nniebezpiecz.:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: dia_danger
                                hint_text: "Ci≈õnienie rozkurczowe max (np. 120)"
                                input_filter: 'int'
                                size_hint_x: 0.6

                    # === SEKCJA TƒòTNO ===
                    AccordionItem:
                        title: "Limity Tƒôtna (bpm)"
                        
                        GridLayout:
                            cols: 2
                            spacing: 5
                            padding: 10
                            
                            Label:
                                text: "Norma min:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: hr_min
                                hint_text: "Tƒôtno minimalne (np. 60)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Norma max:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: hr_max
                                hint_text: "Tƒôtno maksymalne (np. 100)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Niebezpiecz.\nza niskie:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: hr_danger_low
                                hint_text: "Tƒôtno krytycznie niskie (np. 40)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Niebezpiecz.\nza wysokie:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: hr_danger_high
                                hint_text: "Tƒôtno krytycznie wysokie (np. 150)"
                                input_filter: 'int'
                                size_hint_x: 0.6

                    # === SEKCJA GLUKOZA ===
                    AccordionItem:
                        title: "Limity Glukozy (mg/dL)"
                        
                        GridLayout:
                            cols: 2
                            spacing: 5
                            padding: 10
                            
                            Label:
                                text: "Norma min:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: glucose_min
                                hint_text: "Glukoza minimalna (np. 70)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Norma max:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: glucose_max
                                hint_text: "Glukoza maksymalna (np. 140)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Niebezpiecz.\nhipoglikemia:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: glucose_danger_low
                                hint_text: "Hipoglikemia - pr√≥g (np. 50)"
                                input_filter: 'int'
                                size_hint_x: 0.6
                            
                            Label:
                                text: "Niebezpiecz.\nhiperglikemia:"
                                size_hint_x: 0.4
                                color: 0.2, 0.2, 0.2, 1
                            TextInput:
                                id: glucose_danger_high
                                hint_text: "Hiperglikemia - pr√≥g (np. 250)"
                                input_filter: 'int'
                                size_hint_x: 0.6

                # Przycisk zapisu limit√≥w
                Button:
                    text: "Zapisz wszystkie limity"
                    background_color: 0.4, 0.8, 0.6, 1
                    font_size: "18sp"
                    size_hint_y: None
                    height: "50sp"
                    on_press: root.save_limits()

                # === SEKCJA U≈ªYTKOWNICY ===
                Label:
                    text: "ZarzƒÖdzanie U≈ºytkownikami"
                    font_size: "18sp"
                    bold: True
                    color: 0.2, 0.4, 0.6, 1
                    size_hint_y: None
                    height: "35sp"

                GridLayout:
                    cols: 2
                    spacing: 5
                    size_hint_y: None
                    height: "100sp"
                    
                    Button:
                        text: "Zmie≈Ñ PIN"
                        background_color: 0.7, 0.6, 0.9, 1
                        font_size: "16sp"
                        on_press: root.change_pin_selected()
                    
                    Button:
                        text: "Zmie≈Ñ nazwƒô"
                        background_color: 0.6, 0.7, 0.9, 1
                        font_size: "16sp"
                        on_press: root.change_username_selected()
                    
                    Button:
                        text: "Dodaj u≈ºytkownika"
                        background_color: 0.5, 0.8, 0.7, 1
                        font_size: "16sp"
                        on_press: root.add_new_user()
                    
                    Button:
                        text: "Usu≈Ñ u≈ºytkownika"
                        background_color: 0.9, 0.5, 0.5, 1
                        font_size: "16sp"
                        on_press: root.delete_selected_user()

                # === SEKCJA BACKUP ===
                Label:
                    text: "Backup i Przywracanie"
                    font_size: "18sp"
                    bold: True
                    color: 0.3, 0.5, 0.3, 1
                    size_hint_y: None
                    height: "35sp"

                GridLayout:
                    cols: 2
                    spacing: 5
                    size_hint_y: None
                    height: "50sp"
                    
                    Button:
                        text: "Wykonaj backup"
                        background_color: 0.6, 0.7, 0.9, 1
                        font_size: "16sp"
                        on_press: root.backup()
                    
                    Button:
                        text: "Przywr√≥ƒá backup"
                        background_color: 0.9, 0.7, 0.5, 1
                        font_size: "16sp"
                        on_press: root.restore()

                # Odstƒôp przed przyciskiem powrotu
                Widget:
                    size_hint_y: None
                    height: "10sp"

        # Przycisk powrotu na dole
        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "50sp"
            on_press: app.root.current = "home"


<WeightChartScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 1, 0.95, 1  # Jasnozielony
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Wykres Wagi"
            font_size: "28sp"
            bold: True
            color: 0.2, 0.6, 0.3, 1
            size_hint_y: None
            height: "50sp"

        BoxLayout:
            id: chart_container
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press: app.root.current = "weight"


<PressureChartScreen>:
    canvas.before:
        Color:
            rgba: 1, 0.95, 0.95, 1  # Jasnor√≥≈ºowy
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Wykres Ci≈õnienia"
            font_size: "28sp"
            bold: True
            color: 0.8, 0.2, 0.2, 1
            size_hint_y: None
            height: "50sp"

        Label:
            text: "Czerwona = Skurczowe | Niebieska = Rozkurczowe"
            font_size: "14sp"
            color: 0.3, 0.3, 0.3, 1
            size_hint_y: None
            height: "30sp"

        BoxLayout:
            id: chart_container
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press: app.root.current = "pressure"


<WeightHistoryScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 1, 0.95, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Historia Pomiar√≥w Wagi"
            font_size: "26sp"
            bold: True
            color: 0.2, 0.6, 0.3, 1
            size_hint_y: None
            height: "50sp"

        Button:
            text: "üîÑ Sortuj: " + ("Od najstarszych ‚Üë" if root.ascending else "Od najnowszych ‚Üì")
            background_color: 0.6, 0.7, 0.9, 1
            font_size: "20sp"
            size_hint_y: None
            height: "50sp"
            on_press: root.toggle_sort()

        ScrollView:
            RecycleView:
                viewclass: "Label"
                data: root.history
                RecycleBoxLayout:
                    default_size: None, 50
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: "vertical"
                    spacing: 5

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press: app.root.current = "weight"


<PressureHistoryScreen>:
    canvas.before:
        Color:
            rgba: 1, 0.95, 0.95, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Historia Pomiar√≥w Ci≈õnienia"
            font_size: "26sp"
            bold: True
            color: 0.8, 0.2, 0.2, 1
            size_hint_y: None
            height: "50sp"

        Button:
            text: "üîÑ Sortuj: " + ("Od najstarszych ‚Üë" if root.ascending else "Od najnowszych ‚Üì")
            background_color: 0.6, 0.7, 0.9, 1
            font_size: "20sp"
            size_hint_y: None
            height: "50sp"
            on_press: root.toggle_sort()

        ScrollView:
            RecycleView:
                viewclass: "Label"
                data: root.history
                RecycleBoxLayout:
                    default_size: None, 50
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: "vertical"
                    spacing: 5

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press: app.root.current = "pressure"


<HeartRateScreen>:
    canvas.before:
        Color:
            rgba: 1, 0.95, 0.97, 1  # Jasnor√≥≈ºowy
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        Label:
            text: "Tƒôtno"
            font_size: "24sp"
            bold: True
            color: 0.8, 0.3, 0.5, 1
            size_hint_y: None
            height: "40sp"

        TextInput:
            id: heartrate_input
            hint_text: "Tƒôtno (bpm)"
            input_filter: "int"
            background_color: 1, 1, 1, 1
            font_size: "18sp"

        Button:
            text: "Zapisz"
            background_color: 0.9, 0.7, 0.8, 1
            font_size: "20sp"
            on_press:
                root.save_heartrate(heartrate_input.text)
                heartrate_input.text = ""

        Label:
            text: "Ostatnie 5 pomiar√≥w:"
            color: 0.3, 0.3, 0.3, 1
            size_hint_y: None
            height: "30sp"

        Button:
            text: "Poka≈º wykres"
            background_color: 0.6, 0.7, 0.9, 1
            font_size: "20sp"
            on_press: root.show_chart()

        Button:
            text: "Historia pomiar√≥w"
            background_color: 0.8, 0.6, 0.9, 1
            font_size: "20sp"
            on_press: app.root.current = "heartrate_history"

        Button:
            text: "Eksport CSV"
            background_color: 0.9, 0.8, 0.5, 1
            font_size: "20sp"
            on_press: root.export_csv()

        Button:
            text: "Eksport PDF"
            background_color: 0.9, 0.6, 0.5, 1
            font_size: "20sp"
            on_press: root.export_pdf()

        RecycleView:
            size_hint_y: 0.5
            viewclass: "Label"
            data: root.heartrates[:5]

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            on_press: app.root.current = "home"


<GlucoseScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1  # Jasnoniebieski
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        Label:
            text: "Glukoza"
            font_size: "24sp"
            bold: True
            color: 0.3, 0.4, 0.8, 1
            size_hint_y: None
            height: "40sp"

        # Wynik glukozy
        BoxLayout:
            size_hint_y: None
            height: "50sp"
            spacing: 10

            Label:
                text: "Wynik:"
                size_hint_x: 0.3
                color: 0.3, 0.3, 0.3, 1

            TextInput:
                id: glucose_input
                hint_text: "mg/dL"
                input_filter: "int"
                background_color: 1, 1, 1, 1
                font_size: "18sp"

        # Data i czas pomiaru
        Label:
            text: "Kiedy wykonano pomiar:"
            color: 0.3, 0.3, 0.3, 1
            size_hint_y: None
            height: "25sp"

        BoxLayout:
            size_hint_y: None
            height: "50sp"
            spacing: 10

            TextInput:
                id: measurement_date
                hint_text: "RRRR-MM-DD"
                background_color: 1, 1, 1, 1
                font_size: "16sp"
                size_hint_x: 0.6

            TextInput:
                id: measurement_time
                hint_text: "GG:MM"
                background_color: 1, 1, 1, 1
                font_size: "16sp"
                size_hint_x: 0.4

        # Czas od posi≈Çku
        Label:
            text: "Czas pomiaru wzglƒôdem posi≈Çku:"
            color: 0.3, 0.3, 0.3, 1
            size_hint_y: None
            height: "25sp"

        BoxLayout:
            size_hint_y: None
            height: "50sp"
            spacing: 5

            Button:
                text: "Na czczo"
                background_color: (0.5, 0.8, 0.5, 1) if root.meal_timing == "na czczo" else (0.8, 0.8, 0.8, 1)
                font_size: "16sp"
                on_press: root.set_meal_timing("na czczo")

            Button:
                text: "2h po posi≈Çku"
                background_color: (0.5, 0.8, 0.5, 1) if root.meal_timing == "2h po posi≈Çku" else (0.8, 0.8, 0.8, 1)
                font_size: "16sp"
                on_press: root.set_meal_timing("2h po posi≈Çku")

            Button:
                text: "W≈Çasny"
                background_color: (0.5, 0.8, 0.5, 1) if root.meal_timing == "w≈Çasny" else (0.8, 0.8, 0.8, 1)
                font_size: "16sp"
                on_press: root.set_meal_timing("w≈Çasny")

        # Pole na w≈Çasny czas
        TextInput:
            id: custom_timing
            hint_text: "np. 1h po posi≈Çku, przed snem..."
            background_color: 1, 1, 1, 1
            font_size: "16sp"
            size_hint_y: None
            height: "40sp"
            disabled: root.meal_timing != "w≈Çasny"

        Button:
            text: "Zapisz"
            background_color: 0.7, 0.8, 0.9, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press:
                root.save_glucose(glucose_input.text, measurement_date.text, measurement_time.text, custom_timing.text)
                glucose_input.text = ""


        BoxLayout:
            size_hint_y: None
            height: "50sp"
            spacing: 5

            Button:
                text: "Wykres"
                background_color: 0.6, 0.7, 0.9, 1
                font_size: "18sp"
                on_press: root.show_chart()

            Button:
                text: "Historia"
                background_color: 0.8, 0.6, 0.9, 1
                font_size: "18sp"
                on_press: app.root.current = "glucose_history"

        BoxLayout:
            size_hint_y: None
            height: "50sp"
            spacing: 5

            Button:
                text: "CSV"
                background_color: 0.9, 0.8, 0.5, 1
                font_size: "18sp"
                on_press: root.export_csv()

            Button:
                text: "PDF"
                background_color: 0.9, 0.6, 0.5, 1
                font_size: "18sp"
                on_press: root.export_pdf()

        RecycleView:
            size_hint_y: 0.3
            viewclass: "Label"
            data: root.glucose_levels[:5]

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "50sp"
            on_press: app.root.current = "home"


<HeartRateChartScreen>:
    canvas.before:
        Color:
            rgba: 1, 0.95, 0.97, 1  # Jasnor√≥≈ºowy
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Wykres Tƒôtna"
            font_size: "28sp"
            bold: True
            color: 0.8, 0.3, 0.5, 1
            size_hint_y: None
            height: "50sp"

        BoxLayout:
            id: chart_container
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press: app.root.current = "heartrate"


<GlucoseChartScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1  # Jasnoniebieski
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Wykres Glukozy"
            font_size: "28sp"
            bold: True
            color: 0.3, 0.4, 0.8, 1
            size_hint_y: None
            height: "50sp"

        BoxLayout:
            id: chart_container
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press: app.root.current = "glucose"


<HeartRateHistoryScreen>:
    canvas.before:
        Color:
            rgba: 1, 0.95, 0.97, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Historia Pomiar√≥w Tƒôtna"
            font_size: "26sp"
            bold: True
            color: 0.8, 0.3, 0.5, 1
            size_hint_y: None
            height: "50sp"

        Button:
            text: "üîÑ Sortuj: " + ("Od najstarszych ‚Üë" if root.ascending else "Od najnowszych ‚Üì")
            background_color: 0.6, 0.7, 0.9, 1
            font_size: "20sp"
            size_hint_y: None
            height: "50sp"
            on_press: root.toggle_sort()

        ScrollView:
            RecycleView:
                viewclass: "Label"
                data: root.history
                RecycleBoxLayout:
                    default_size: None, 50
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: "vertical"
                    spacing: 5

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press: app.root.current = "heartrate"


<GlucoseHistoryScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Label:
            text: "Historia Pomiar√≥w Glukozy"
            font_size: "26sp"
            bold: True
            color: 0.3, 0.4, 0.8, 1
            size_hint_y: None
            height: "50sp"

        Button:
            text: "üîÑ Sortuj: " + ("Od najstarszych ‚Üë" if root.ascending else "Od najnowszych ‚Üì")
            background_color: 0.6, 0.7, 0.9, 1
            font_size: "20sp"
            size_hint_y: None
            height: "50sp"
            on_press: root.toggle_sort()

        ScrollView:
            RecycleView:
                viewclass: "Label"
                data: root.history
                RecycleBoxLayout:
                    default_size: None, 50
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: "vertical"
                    spacing: 5

        Button:
            text: "Powr√≥t"
            background_color: 0.7, 0.7, 0.7, 1
            font_size: "20sp"
            size_hint_y: None
            height: "60sp"
            on_press: app.root.current = "glucose"
